<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>卫星轨道可视化系统</title>

    <!-- Cesium库 -->
    <script src="https://cesium.com/downloads/cesiumjs/releases/1.88/Build/Cesium/Cesium.js"></script>
    <link href="https://cesium.com/downloads/cesiumjs/releases/1.88/Build/Cesium/Widgets/widgets.css" rel="stylesheet">

    <!-- 自定义样式 -->
    <link href="/static/css/styles.css" rel="stylesheet">

    <!-- 全局变量声明 -->
    <script>
        // 从Flask模板传递的全局变量
        window.CESIUM_TOKEN = '{{ cesium_token }}';
        window.MODEL_URL = '{{ model_url }}';
        window.CURRENT_TIME_ISO = '{{ current_time_iso }}';
    </script>
</head>
<body>
    <!-- Cesium容器 - 全屏 -->
    <div id="cesiumContainer"></div>

    <!-- 加载提示 -->
    <div id="loadingMessage">
        正在初始化卫星轨道可视化系统...
        <div class="status-info" id="statusInfo"></div>
    </div>

    <!-- 浮动控制菜单 -->
    <div id="floatingMenu">
        <button id="menuToggle" class="menu-btn">
            <span>☰</span> 菜单
        </button>

        <div id="menuContent" class="menu-content">
            <div class="menu-section">
                <h4>卫星控制</h4>
                <button id="resetView">重置视图</button>
                <button id="showAllSatellites">显示所有卫星</button>
                <button id="toggleOrbits">切换轨道</button>
                <button id="toggleProjections">切换投影</button>
                <div class="menu-checkbox">
                    <input type="checkbox" id="toggleLabels" checked>
                    <label for="toggleLabels">显示标签</label>
                </div>
            </div>

            <div class="menu-section">
                <h4>侧摆角度</h4>
                <input type="range" id="sideAngleSlider" min="0" max="60" value="20">
                <span id="sideAngleValue">20°</span>
                <button id="updateSideAngle">更新</button>
            </div>

            <div class="menu-section">
                <h4>时间控制</h4>
                <input type="datetime-local" id="timeInput" value="{{ current_time_iso }}">
                <button id="jumpToTime">跳转</button>
                <div class="menu-checkbox">
                    <input type="checkbox" id="realTimeMode">
                    <label for="realTimeMode">实时模式</label>
                </div>
            </div>

            <div class="menu-section">
                <h4>覆盖查询</h4>
                <input type="number" id="latitudeInput" placeholder="纬度" step="any" min="-90" max="90">
                <input type="number" id="longitudeInput" placeholder="经度" step="any" min="-180" max="180">
                <button id="queryButton">查询</button>
            </div>

            <div class="menu-section">
                <h4>卫星列表</h4>
                <div id="satelliteList">
                    {% if satellites %}
                    {% for satellite in satellites %}
                    <div class="satellite-item" data-index="{{ loop.index0 }}">
                        <span class="satellite-name">{{ satellite.name }}</span>
                        <button class="view-satellite" data-index="{{ loop.index0 }}">查看</button>
                    </div>
                    {% endfor %}
                    {% else %}
                    <div>没有找到卫星数据</div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- 底部时间控制条 -->
    <div id="timeControlBar">
        <button id="playPauseButton">▶ 播放</button>
        <button id="resetTimeButton">重置时间</button>
        <label for="timeSpeedSelect">速度:</label>
        <select id="timeSpeedSelect">
            <option value="1">1x</option>
            <option value="10">10x</option>
            <option value="60" selected>60x</option>
            <option value="300">300x</option>
            <option value="600">600x</option>
            <option value="3600">3600x</option>
        </select>
        <span id="currentTimeDisplay"></span>
    </div>

    <!-- 查询结果面板 -->
    <div id="queryResultsPanel">
        <button id="closeResults" class="close-btn">×</button>
        <div id="queryResultsContent"></div>
    </div>

    <!-- 自定义JavaScript -->
    <script src="/static/js/app.js"></script>
</body>
</html>